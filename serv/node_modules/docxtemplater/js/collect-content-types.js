"use strict";

const ctXML = "[Content_Types].xml";

function collectContentTypes(overrides, defaults, zip) {
  const partNames = {};

  for (const override of overrides) {
    const contentType = override.getAttribute("ContentType");
    const partName = override.getAttribute("PartName").substr(1);

    if (!contentType || !partName) {
      throw new Error("Missing required attributes in override");
    }

    partNames[partName] = contentType;
  }

  for (const def of defaults) {
    const contentType = def.getAttribute("ContentType");
    const extension = def.getAttribute("Extension");

    if (!contentType || !extension) {
      throw new Error("Missing required attributes in default");
    }

    const matchingFile = zip.file(file => file.name.endsWith(extension) && file.name !== ctXML);

    if (matchingFile && !partNames[matchingFile.name]) {
      partNames[matchingFile.name] = contentType;
    }
  }

  return partNames;
}

module.exports = collectContentTypes;
